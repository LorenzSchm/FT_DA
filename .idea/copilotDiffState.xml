<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/mobile/components/saving-goals/SavingGoals.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/mobile/components/saving-goals/SavingGoals.tsx" />
              <option name="originalContent" value="&quot;use client&quot;;&#10;import React, { useState, useEffect } from &quot;react&quot;;&#10;import {&#10;  View,&#10;  Text,&#10;  ScrollView,&#10;  TouchableOpacity,&#10;  Pressable,&#10;  TouchableWithoutFeedback,&#10;} from &quot;react-native&quot;;&#10;import SavingsAddAccountModal from &quot;@/components/modals/SavingsAddAccountModal&quot;;&#10;import SavingsAddTransactionModal from &quot;@/components/modals/SavingsAddTransactionModal&quot;;&#10;import CircularProgress from &quot;@/components/saving-goals/CircularProgress&quot;;&#10;import SavingsDetailModal from &quot;@/components/modals/SavingsDetailModal&quot;;&#10;import axios from &quot;axios&quot;;&#10;import { useAuthStore } from &quot;@/utils/authStore&quot;;&#10;import { fetchSavingsAccounts } from &quot;@/utils/db/finance/saving-goals/saving-goals&quot;;&#10;import { handleAddAccount } from &quot;@/utils/db/finance/saving-goals/saving-goals&quot;;&#10;import { handleAddTransaction } from &quot;@/utils/db/finance/saving-goals/saving-goals&quot;;&#10;const INITIAL_SAVINGS: any[] = [];&#10;const API_URL = process.env.EXPO_PUBLIC_API_URL || &quot;http://localhost:8000&quot;;&#10;&#10;type Transaction = {&#10;  id: number;&#10;  savingId: number;&#10;  description: string;&#10;  amount: number; // in cents&#10;  date: string;&#10;  type: &quot;add&quot; | &quot;subtract&quot;;&#10;};&#10;&#10;export default function SavingGoals() {&#10;  const [savings, setSavings] = useState(INITIAL_SAVINGS);&#10;  const [transactions, setTransactions] = useState&lt;Transaction[]&gt;([]);&#10;  const [showAddAccountModal, setShowAddAccountModal] = useState(false);&#10;  const [showAddTransactionModal, setShowAddTransactionModal] = useState(false);&#10;  const [showDetailView, setShowDetailView] = useState(false);&#10;  const [expanded, setExpanded] = useState(false);&#10;  const [selectedSavingId, setSelectedSavingId] = useState&lt;number | null&gt;(null);&#10;  const [isLoading, setIsLoading] = useState(false);&#10;  const {user, session} = useAuthStore();&#10;&#10;  const handleSavingClick = (savingId: number) =&gt; {&#10;    setSelectedSavingId(savingId);&#10;    setShowDetailView(true);&#10;  };&#10;&#10;  const handleCloseDetailView = () =&gt; {&#10;    setShowDetailView(false);&#10;    setSelectedSavingId(null);&#10;  };&#10;&#10;  useEffect(() =&gt; {&#10;    const fetchAccounts = async () =&gt; {&#10;      const accounts = await fetchSavingsAccounts(session);&#10;      if (accounts) {&#10;        setSavings(accounts);&#10;      }&#10;    };&#10;    fetchAccounts();&#10;  }, [session]);&#10;&#10;  useEffect(() =&gt; {&#10;    console.log(&quot;Savings state updated:&quot;, savings.length, &quot;accounts&quot;);&#10;  }, [savings]);&#10;&#10;  const totalAmount = savings.reduce(&#10;      (sum: number, saving: any) =&gt; sum + (saving.contributed_minor || 0),&#10;      0&#10;  );&#10;  const totalGoal = savings.reduce(&#10;      (sum: number, saving: any) =&gt; sum + (saving.target_minor || 0),&#10;      0&#10;  );&#10;  const overallProgress = totalGoal &gt; 0 ? (totalAmount / totalGoal) * 100 : 0;&#10;&#10;  const toggleExpanded = () =&gt; setExpanded(!expanded);&#10;&#10;  const openAddAccountModal = () =&gt; {&#10;    setShowAddAccountModal(true);&#10;    setExpanded(false);&#10;  };&#10;&#10;  const openAddTransactionModal = () =&gt; {&#10;    setShowAddTransactionModal(true);&#10;    setExpanded(false);&#10;  };&#10;&#10;  const addAccount = async (accountName: string, initialAmount: string,) =&gt; {&#10;    setIsLoading(true);&#10;    try {&#10;      const newSavings = await handleAddAccount(accountName, initialAmount, session);&#10;      if (newSavings) {&#10;        setSavings(newSavings);&#10;      }&#10;    } catch (error) {&#10;      console.error(&quot;Error adding savings account:&quot;, error);&#10;    } finally {&#10;      setIsLoading(false);&#10;    }&#10;  }&#10;&#10;  const addTransaction = async (&#10;      savingId: number,&#10;      type: &quot;add&quot; | &quot;subtract&quot;,&#10;      description: string,&#10;      amount: string&#10;  ) =&gt; {&#10;    setIsLoading(true);&#10;    try {&#10;      const result = await handleAddTransaction(&#10;          savingId,&#10;          type,&#10;          description,&#10;          amount,&#10;          session&#10;      );&#10;      if (result &amp;&amp; result.accounts) {&#10;        setSavings(result.accounts);&#10;      }&#10;    } catch (error) {&#10;      console.error(&quot;Error adding transaction:&quot;, error);&#10;    } finally {&#10;      setIsLoading(false);&#10;    }&#10;  }&#10;&#10;    return (&#10;        &lt;View className=&quot;flex-1 bg-white&quot;&gt;&#10;          &lt;ScrollView className=&quot;flex-1 px-7 pt-4&quot;&gt;&#10;            &lt;View className=&quot;mb-8 items-center justify-center py-8&quot;&gt;&#10;              &lt;CircularProgress&#10;                  size={220}&#10;                  strokeWidth={16}&#10;                  progress={overallProgress}&#10;                  totalAmount={totalAmount / 100}&#10;                  currency=&quot;€&quot;&#10;              /&gt;&#10;            &lt;/View&gt;&#10;&#10;            {/* Savings Accounts List */}&#10;            &lt;View className=&quot;mb-20&quot;&gt;&#10;              &lt;Text className=&quot;text-2xl font-bold mb-4&quot;&gt;Savings&lt;/Text&gt;&#10;              {savings.length === 0 ? (&#10;                  &lt;View className=&quot;py-8 items-center&quot;&gt;&#10;                    &lt;Text className=&quot;text-neutral-500 text-center&quot;&gt;&#10;                      No savings accounts yet.{&quot;\n&quot;}Create your first account to get started!&#10;                    &lt;/Text&gt;&#10;                  &lt;/View&gt;&#10;              ) : (&#10;                  savings.map((saving) =&gt; {&#10;                    return (&#10;                        &lt;Pressable&#10;                            key={saving.id}&#10;                            onPress={() =&gt; handleSavingClick(saving.id)}&#10;                            className=&quot;mb-0.5 bg-white rounded-2xl p-4&quot;&#10;                        &gt;&#10;                          {/* Header */}&#10;                          &lt;View className=&quot;flex-row justify-between items-center&quot;&gt;&#10;                            &lt;View&gt;&#10;                              &lt;Text className=&quot;text-lg font-bold&quot;&gt;{saving.name}&lt;/Text&gt;&#10;                              &lt;Text className=&quot;text-sm text-neutral-500 mt-1&quot;&gt;&#10;                                {&quot;FT&quot;}&#10;                              &lt;/Text&gt;&#10;                            &lt;/View&gt;&#10;                            &lt;View className=&quot;items-end&quot;&gt;&#10;                              &lt;Text className=&quot;text-lg font-bold&quot;&gt;&#10;                                {saving.currency || &quot;€&quot;}&#10;                                {((saving.contributed_minor || 0) / 100).toFixed(2)}&#10;                              &lt;/Text&gt;&#10;                            &lt;/View&gt;&#10;                          &lt;/View&gt;&#10;                        &lt;/Pressable&gt;&#10;                    );&#10;                  })&#10;              )}&#10;            &lt;/View&gt;&#10;          &lt;/ScrollView&gt;&#10;&#10;          {/* Floating Add Button */}&#10;          &lt;View className=&quot;absolute bottom-12 right-5&quot;&gt;&#10;            {expanded &amp;&amp; (&#10;                &lt;TouchableWithoutFeedback onPress={() =&gt; setExpanded(false)}&gt;&#10;                  &lt;View className=&quot;absolute inset-0&quot;/&gt;&#10;                &lt;/TouchableWithoutFeedback&gt;&#10;            )}&#10;&#10;            &lt;TouchableOpacity&#10;                activeOpacity={0.9}&#10;                onPress={toggleExpanded}&#10;                className={`${&#10;                    expanded&#10;                        ? &quot;bg-black w-64 py-6 rounded-[25px]&quot;&#10;                        : &quot;bg-black w-40 py-4 rounded-full&quot;&#10;                }`}&#10;            &gt;&#10;              {!expanded ? (&#10;                  &lt;View className=&quot;items-center justify-center&quot;&gt;&#10;                    &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;Add +&lt;/Text&gt;&#10;                  &lt;/View&gt;&#10;              ) : (&#10;                  &lt;View className=&quot;flex-col justify-center px-6 space-y-3&quot;&gt;&#10;                    &lt;TouchableOpacity&#10;                        className=&quot;flex-row justify-between items-center pb-3&quot;&#10;                        onPress={openAddAccountModal}&#10;                    &gt;&#10;                      &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;&#10;                        Account&#10;                      &lt;/Text&gt;&#10;                      &lt;Text className=&quot;text-white text-3xl&quot;&gt;›&lt;/Text&gt;&#10;                    &lt;/TouchableOpacity&gt;&#10;&#10;                    &lt;TouchableOpacity&#10;                        className=&quot;flex-row justify-between items-center&quot;&#10;                        onPress={openAddTransactionModal}&#10;                    &gt;&#10;                      &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;&#10;                        Transaction&#10;                      &lt;/Text&gt;&#10;                      &lt;Text className=&quot;text-white text-3xl&quot;&gt;›&lt;/Text&gt;&#10;                    &lt;/TouchableOpacity&gt;&#10;                  &lt;/View&gt;&#10;              )}&#10;            &lt;/TouchableOpacity&gt;&#10;          &lt;/View&gt;&#10;&#10;          {/* Modals */}&#10;          &lt;SavingsAddAccountModal&#10;              isVisible={showAddAccountModal}&#10;              onClose={() =&gt; setShowAddAccountModal(false)}&#10;              onSave={(name, initialAmount) =&gt; addAccount(name, initialAmount)}&#10;          /&gt;&#10;&#10;          &lt;SavingsAddTransactionModal&#10;              isVisible={showAddTransactionModal}&#10;              onClose={() =&gt; {&#10;                setShowAddTransactionModal(false);&#10;                setSelectedSavingId(null);&#10;              }}&#10;              selectedSavingId={selectedSavingId}&#10;              onSave={(savingId, type, description, amount) =&gt;&#10;                  addTransaction(savingId, type, description, amount)&#10;              }&#10;              savings={savings}&#10;          /&gt;&#10;&#10;          {/* Detail Modal */}&#10;          {selectedSavingId &amp;&amp; (&#10;              &lt;SavingsDetailModal&#10;                  isVisible={showDetailView}&#10;                  onClose={handleCloseDetailView}&#10;                  savingId={selectedSavingId}&#10;                  savingName={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.name ||&#10;                      &quot;Savings Account&quot;&#10;                  }&#10;                  currentAmount={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.currentAmount ||&#10;                      0&#10;                  }&#10;                  goalAmount={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.goalAmount || 0&#10;                  }&#10;                  currency={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.currency || &quot;€&quot;&#10;                  }&#10;                  transactions={transactions.filter(&#10;                      (t) =&gt; t.savingId === selectedSavingId&#10;                  )}&#10;              /&gt;&#10;          )}&#10;        &lt;/View&gt;&#10;    );&#10;  }&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;import React, { useState, useEffect } from &quot;react&quot;;&#10;import {&#10;  View,&#10;  Text,&#10;  ScrollView,&#10;  TouchableOpacity,&#10;  Pressable,&#10;  TouchableWithoutFeedback,&#10;} from &quot;react-native&quot;;&#10;import SavingsAddAccountModal from &quot;@/components/modals/SavingsAddAccountModal&quot;;&#10;import SavingsAddTransactionModal from &quot;@/components/modals/SavingsAddTransactionModal&quot;;&#10;import CircularProgress from &quot;@/components/saving-goals/CircularProgress&quot;;&#10;import SavingsDetailModal from &quot;@/components/modals/SavingsDetailModal&quot;;&#10;import { useAuthStore } from &quot;@/utils/authStore&quot;;&#10;import { fetchSavingsAccounts, handleAddAccount, handleAddTransaction } from &quot;@/utils/db/finance/saving-goals/saving-goals&quot;;&#10;const INITIAL_SAVINGS: any[] = [];&#10;&#10;type Transaction = {&#10;  id: number;&#10;  savingId: number;&#10;  description: string;&#10;  amount: number; // in cents&#10;  date: string;&#10;  type: &quot;add&quot; | &quot;subtract&quot;;&#10;};&#10;&#10;export default function SavingGoals() {&#10;  const [savings, setSavings] = useState(INITIAL_SAVINGS);&#10;  const [transactions] = useState&lt;Transaction[]&gt;([]);&#10;  const [showAddAccountModal, setShowAddAccountModal] = useState(false);&#10;  const [showAddTransactionModal, setShowAddTransactionModal] = useState(false);&#10;  const [showDetailView, setShowDetailView] = useState(false);&#10;  const [expanded, setExpanded] = useState(false);&#10;  const [selectedSavingId, setSelectedSavingId] = useState&lt;number | null&gt;(null);&#10;  const { session } = useAuthStore();&#10;&#10;  const handleSavingClick = (savingId: number) =&gt; {&#10;    setSelectedSavingId(savingId);&#10;    setShowDetailView(true);&#10;  };&#10;&#10;  const handleCloseDetailView = () =&gt; {&#10;    setShowDetailView(false);&#10;    setSelectedSavingId(null);&#10;  };&#10;&#10;  useEffect(() =&gt; {&#10;    const fetchAccounts = async () =&gt; {&#10;      const accounts = await fetchSavingsAccounts(session);&#10;      if (accounts) {&#10;        setSavings(accounts);&#10;      }&#10;    };&#10;    fetchAccounts();&#10;  }, [session]);&#10;&#10;  useEffect(() =&gt; {&#10;    console.log(&quot;Savings state updated:&quot;, savings.length, &quot;accounts&quot;);&#10;  }, [savings]);&#10;&#10;  const totalAmount = savings.reduce(&#10;      (sum: number, saving: any) =&gt; sum + (saving.contributed_minor || 0),&#10;      0&#10;  );&#10;  const totalGoal = savings.reduce(&#10;      (sum: number, saving: any) =&gt; sum + (saving.target_minor || 0),&#10;      0&#10;  );&#10;  const overallProgress = totalGoal &gt; 0 ? (totalAmount / totalGoal) * 100 : 0;&#10;&#10;  const toggleExpanded = () =&gt; setExpanded(!expanded);&#10;&#10;  const openAddAccountModal = () =&gt; {&#10;    setShowAddAccountModal(true);&#10;    setExpanded(false);&#10;  };&#10;&#10;  const openAddTransactionModal = () =&gt; {&#10;    setShowAddTransactionModal(true);&#10;    setExpanded(false);&#10;  };&#10;&#10;  const addAccount = async (accountName: string, initialAmount: string,) =&gt; {&#10;    try {&#10;      const newSavings = await handleAddAccount(accountName, initialAmount, session);&#10;      if (newSavings) {&#10;        setSavings(newSavings);&#10;      }&#10;    } catch (error) {&#10;      console.error(&quot;Error adding savings account:&quot;, error);&#10;    }&#10;  }&#10;&#10;  const addTransaction = async (&#10;      savingId: number,&#10;      type: &quot;add&quot; | &quot;subtract&quot;,&#10;      description: string,&#10;      amount: string&#10;  ) =&gt; {&#10;    try {&#10;      const result = await handleAddTransaction(&#10;          savingId,&#10;          type,&#10;          description,&#10;          amount,&#10;          session&#10;      );&#10;      if (result &amp;&amp; result.accounts) {&#10;        setSavings(result.accounts);&#10;      }&#10;    } catch (error) {&#10;      console.error(&quot;Error adding transaction:&quot;, error);&#10;    }&#10;  }&#10;&#10;    return (&#10;        &lt;View className=&quot;flex-1 bg-white&quot;&gt;&#10;          &lt;ScrollView className=&quot;flex-1 px-7 pt-4&quot;&gt;&#10;            &lt;View className=&quot;mb-8 items-center justify-center py-8&quot;&gt;&#10;              &lt;CircularProgress&#10;                  size={220}&#10;                  strokeWidth={16}&#10;                  progress={overallProgress}&#10;                  totalAmount={totalAmount / 100}&#10;                  currency=&quot;€&quot;&#10;              /&gt;&#10;            &lt;/View&gt;&#10;&#10;            {/* Savings Accounts List */}&#10;            &lt;View className=&quot;mb-20&quot;&gt;&#10;              &lt;Text className=&quot;text-2xl font-bold mb-4&quot;&gt;Savings&lt;/Text&gt;&#10;              {savings.length === 0 ? (&#10;                  &lt;View className=&quot;py-8 items-center&quot;&gt;&#10;                    &lt;Text className=&quot;text-neutral-500 text-center&quot;&gt;&#10;                      No savings accounts yet.{&quot;\n&quot;}Create your first account to get started!&#10;                    &lt;/Text&gt;&#10;                  &lt;/View&gt;&#10;              ) : (&#10;                  savings.map((saving) =&gt; {&#10;                    return (&#10;                        &lt;Pressable&#10;                            key={saving.id}&#10;                            onPress={() =&gt; handleSavingClick(saving.id)}&#10;                            className=&quot;mb-0.5 bg-white rounded-2xl p-4&quot;&#10;                        &gt;&#10;                          {/* Header */}&#10;                          &lt;View className=&quot;flex-row justify-between items-center&quot;&gt;&#10;                            &lt;View&gt;&#10;                              &lt;Text className=&quot;text-lg font-bold&quot;&gt;{saving.name}&lt;/Text&gt;&#10;                              &lt;Text className=&quot;text-sm text-neutral-500 mt-1&quot;&gt;&#10;                                {&quot;FT&quot;}&#10;                              &lt;/Text&gt;&#10;                            &lt;/View&gt;&#10;                            &lt;View className=&quot;items-end&quot;&gt;&#10;                              &lt;Text className=&quot;text-lg font-bold&quot;&gt;&#10;                                {saving.currency || &quot;€&quot;}&#10;                                {((saving.contributed_minor || 0) / 100).toFixed(2)}&#10;                              &lt;/Text&gt;&#10;                            &lt;/View&gt;&#10;                          &lt;/View&gt;&#10;                        &lt;/Pressable&gt;&#10;                    );&#10;                  })&#10;              )}&#10;            &lt;/View&gt;&#10;          &lt;/ScrollView&gt;&#10;&#10;          {/* Floating Add Button */}&#10;          &lt;View className=&quot;absolute bottom-12 right-5&quot;&gt;&#10;            {expanded &amp;&amp; (&#10;                &lt;TouchableWithoutFeedback onPress={() =&gt; setExpanded(false)}&gt;&#10;                  &lt;View className=&quot;absolute inset-0&quot;/&gt;&#10;                &lt;/TouchableWithoutFeedback&gt;&#10;            )}&#10;&#10;            &lt;TouchableOpacity&#10;                activeOpacity={0.9}&#10;                onPress={toggleExpanded}&#10;                className={`${&#10;                    expanded&#10;                        ? &quot;bg-black w-64 py-6 rounded-[25px]&quot;&#10;                        : &quot;bg-black w-40 py-4 rounded-full&quot;&#10;                }`}&#10;            &gt;&#10;              {!expanded ? (&#10;                  &lt;View className=&quot;items-center justify-center&quot;&gt;&#10;                    &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;Add +&lt;/Text&gt;&#10;                  &lt;/View&gt;&#10;              ) : (&#10;                  &lt;View className=&quot;flex-col justify-center px-6 space-y-3&quot;&gt;&#10;                    &lt;TouchableOpacity&#10;                        className=&quot;flex-row justify-between items-center pb-3&quot;&#10;                        onPress={openAddAccountModal}&#10;                    &gt;&#10;                      &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;&#10;                        Account&#10;                      &lt;/Text&gt;&#10;                      &lt;Text className=&quot;text-white text-3xl&quot;&gt;›&lt;/Text&gt;&#10;                    &lt;/TouchableOpacity&gt;&#10;&#10;                    &lt;TouchableOpacity&#10;                        className=&quot;flex-row justify-between items-center&quot;&#10;                        onPress={openAddTransactionModal}&#10;                    &gt;&#10;                      &lt;Text className=&quot;text-white text-3xl font-semibold&quot;&gt;&#10;                        Transaction&#10;                      &lt;/Text&gt;&#10;                      &lt;Text className=&quot;text-white text-3xl&quot;&gt;›&lt;/Text&gt;&#10;                    &lt;/TouchableOpacity&gt;&#10;                  &lt;/View&gt;&#10;              )}&#10;            &lt;/TouchableOpacity&gt;&#10;          &lt;/View&gt;&#10;&#10;          {/* Modals */}&#10;          &lt;SavingsAddAccountModal&#10;              isVisible={showAddAccountModal}&#10;              onClose={() =&gt; setShowAddAccountModal(false)}&#10;              onSave={(name, initialAmount) =&gt; addAccount(name, initialAmount)}&#10;          /&gt;&#10;&#10;          &lt;SavingsAddTransactionModal&#10;              isVisible={showAddTransactionModal}&#10;              onClose={() =&gt; {&#10;                setShowAddTransactionModal(false);&#10;                setSelectedSavingId(null);&#10;              }}&#10;              selectedSavingId={selectedSavingId}&#10;              onSave={(savingId, type, description, amount) =&gt;&#10;                  addTransaction(savingId, type, description, amount)&#10;              }&#10;              savings={savings}&#10;          /&gt;&#10;&#10;          {/* Detail Modal */}&#10;          {selectedSavingId &amp;&amp; (&#10;              &lt;SavingsDetailModal&#10;                  isVisible={showDetailView}&#10;                  onClose={handleCloseDetailView}&#10;                  savingId={selectedSavingId}&#10;                  savingName={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.name ||&#10;                      &quot;Savings Account&quot;&#10;                  }&#10;                  currentAmount={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.currentAmount ||&#10;                      0&#10;                  }&#10;                  goalAmount={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.goalAmount || 0&#10;                  }&#10;                  currency={&#10;                      savings.find((s) =&gt; s.id === selectedSavingId)?.currency || &quot;€&quot;&#10;                  }&#10;                  transactions={transactions.filter(&#10;                      (t) =&gt; t.savingId === selectedSavingId&#10;                  )}&#10;              /&gt;&#10;          )}&#10;        &lt;/View&gt;&#10;    );&#10;  }" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>